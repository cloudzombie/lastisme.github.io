/* Build fingerprint: 68f1780cff6001f7ebaca854d6197f70 */
function printCallback(t,e){console.log(e)}function showDialog(t){var e=$("#dialog"+t).data("dialog");e.open(),loadTable(t)}function createWinnerRow(t){return"<tr><td>"+new Date(1e3*t.timestamp).toLocaleString()+"</td><td>"+t.winner+'</td><td class="align-right">'+t.jackpot.ether+" ether</td></tr>"}function extractWinnerData(t,e){var n=e.substring(2),a=n.substring(0,64),o=n.substring(64,128),r=n.substring(128,192),i="0x"+a.substring(24),s={};s.wei=new BigNumber(o,16).toNumber(),s.ether=1*t.fromWei(s.wei,"ether");var c=new BigNumber(r,16).toNumber();return{winner:i,jackpot:s,timestamp:c}}function loadTable(t){for(var e=contractsData[t],n=e.totalWinners,a=web3.createBatch(),o=[],r=n-1;r>=0&&o.length<10;){var i=getWinnerBatchPromise(web3,a,t,r);o.push(i),r--}Promise.all(o).then(function(e){var n=$("#ptablebody"+t);n.empty(),0==e.length&&n.append("<tr><td>No winners yet</td></tr>");for(var a=0;a<e.length;a++){var o=e[a],r=extractWinnerData(web3,o.winner);console.log(r),n.append(createWinnerRow(r))}})["catch"](function(t){console.log("err="+t)}),a.execute()}function initProvider(){return new Promise(function(t,e){for(var n=[],a=shuffle(WEB3_PROVIDERS),o=0;o<a.length;o++){var r=a[o],i=getLastBlockPromise(r);n.push(i)}console.log(a),Promise.all(n.map(softFail)).then(function(e){console.log(e);for(var n={},o=[],r=0;r<a.length;r++)try{var i=parseInt(JSON.parse(e[r].response).result,16),s=e[r].elapsed;o.push(i),n[a[r]]={block:i,elapsed:s}}catch(c){}console.log(n),o.sort(sortNumber),console.log(o);var l=Math.floor(o.length/2.001),u=o[l];console.log("consideredSynced "+u);var m=!1;if(LOCAL_PROVIDER in n){var p=n[LOCAL_PROVIDER].block;if(console.log("localhost available, block is "+p),Math.abs(p-u)<DISTANCE_SYNCED){console.log("localhost is synced ");var d=new Web3(new Web3.providers.HttpProvider(LOCAL_PROVIDER));m=!0,t({web3:d,lastBlock:p})}else console.log("localhost is not synced")}for(var h in n)if(!m){var f=n[h].block;if(Math.abs(f-u)<DISTANCE_SYNCED){console.log(h+" is synced ");var d=new Web3(new Web3.providers.HttpProvider(h));m=!0,t({web3:d,lastBlock:f})}}})})}function sortNumber(t,e){return e-t}function shuffle(t){for(var e,n,a=t.length;a;)n=Math.floor(Math.random()*a--),e=t[a],t[a]=t[n],t[n]=e;return t}function getStorageAtPromise(t,e,n){return new Promise(function(e,a){t.eth.getStorageAt(ADDRESS,n,"latest",function(t,n){e(n)})})}function getBalancePromise(t,e){return new Promise(function(n,a){t.eth.getBalance(e,function(t,o){t?a(t):n({contract:e,balance:o.toNumber()})})})}function getRemainingPromise(t){return new Promise(function(e,n){t.remaining(function(a,o){a?n(a):e({contract:t.address,remaining:o.toNumber()})})})}function getOwnerPromise(t){return new Promise(function(e,n){t.owner(function(a,o){a?n(a):e({contract:t.address,owner:o})})})}function getLastPlayerPromise(t){return new Promise(function(e,n){t.lastPlayer(function(a,o){a?n(a):e({contract:t.address,lastPlayer:o})})})}function getBlockPromise(t){return new Promise(function(e,n){t.blocks(function(a,o){a?n(a):e({contract:t.address,blocks:o.toNumber()})})})}function getPricePromise(t){return new Promise(function(e,n){t.price(function(a,o){a?n(a):e({contract:t.address,price:o.toNumber()})})})}function getBalanceBatchPromise(t,e,n){return new Promise(function(a,o){var r=t.eth.getBalance.request(n,"latest",function(t,e){a({contract:n,balance:e})});e.add(r)})}function getStorageAtBatchPromise(t,e,n,a){return new Promise(function(o,r){var i=t.eth.getStorageAt.request(n,a,"latest",function(t,e){o({contract:n,data:e})});e.add(i)})}function getLastPlayerBatchPromise(t,e,n){return new Promise(function(a,o){var r={to:n,data:padRight("0xe3450e13")},i=t.eth.call.request(r,"latest",function(t,e){a({contract:n,lastPlayer:e})});e.add(i)})}function getPriceBatchPromise(t,e,n){return new Promise(function(a,o){var r={to:n,data:padRight("0xa035b1fe")},i=t.eth.call.request(r,"latest",function(t,e){a({contract:n,price:e})});e.add(i)})}function getBlocksBatchPromise(t,e,n){return new Promise(function(a,o){var r={to:n,data:padRight("0x967ff23e")},i=t.eth.call.request(r,"latest",function(t,e){a({contract:n,blocks:e})});e.add(i)})}function getJackpotBatchPromise(t,e,n){return new Promise(function(a,o){var r={to:n,data:padRight("0x6b31ee01")},i=t.eth.call.request(r,"latest",function(t,e){a({contract:n,jackpot:e})});e.add(i)})}function getRemainingBatchPromise(t,e,n){return new Promise(function(a,o){var r={to:n,data:padRight("0x55234ec0")},i=t.eth.call.request(r,"latest",function(t,e){a({contract:n,remaining:e})});e.add(i)})}function getWinnerBatchPromise(t,e,n,a){return new Promise(function(o,r){var i={to:n,data:"0xa2fb1175"+pad(a.toString(16),64)};console.log("web3.eth.call("+JSON.stringify(i)+");");var s=t.eth.call.request(i,"latest",function(t,e){o({contract:n,winner:e})});e.add(s)})}function getTotalWinnerBatchPromise(t,e,n){return new Promise(function(a,o){var r=t.eth.call.request({to:n,data:padRight("0xbcc941b6")},"latest",function(t,e){a({contract:n,totalWinners:e})});e.add(r)})}function getContractDataPromiseBatch(t,e){var n=t.createBatch(),a=getBalanceBatchPromise(t,n,e),o=getLastPlayerBatchPromise(t,n,e),r=getRemainingBatchPromise(t,n,e),i=getTotalWinnerBatchPromise(t,n,e),s=getJackpotBatchPromise(t,n,e),c=getPriceBatchPromise(t,n,e),l=getBlocksBatchPromise(t,n,e);return n.execute(),Promise.all([a,o,r,i,s,c,l])}function getContractDataPromise(t,e){var n=[],a=t.eth.contract(CONTRACTS_ABI).at(e);return n.push(getBalancePromise(t,e)),n.push(getLastPlayerPromise(a)),n.push(getRemainingPromise(a)),Promise.all(n)}function getContractsPromises(t){return new Promise(function(e,n){t.then(function(t){for(var n=t.web3,a=[],o=0;o<MY_CONTRACTS.length;o++){var r=MY_CONTRACTS[o],i=getContractDataPromiseBatch(n,r);a.push(i)}e(a)})})}function createIdenticon(t,e){var n=blockies.create({seed:e,size:8,scale:16}).toDataURL(),a="url("+n+")";t.css("background-image",a)}function getLastBlockPromise(t){var e=JSON.stringify({jsonrpc:"2.0",method:"eth_blockNumber",params:[],id:1});return makeRequest({method:"POST",url:t,params:e})}function getStatsPromise(){return new Promise(function(t,e){var n=getEtherScanPromise(),a=getEtherStatsPromise();a.then(function(e){t(e)})["catch"](function(a){n.then(function(e){t(e)})["catch"](function(t){e(t)})})})}function getEtherScanPromise(){return new Promise(function(t,e){var n=makeRequest({method:"GET",url:"http://api.etherscan.io/api?module=stats&action=ethprice",timeout:3e3});n.then(function(e){var n=JSON.parse(e.response),a=1*n.result.ethusd,o={blockTime:14,price:a};t(o),console.log(n)})["catch"](function(t){e(t)})})}function getEtherStatsPromise(){return new Promise(function(t,e){var n=makeRequest({method:"GET",url:"https://www.etherchain.org/api/basic_stats",timeout:3e3});n.then(function(e){var n=JSON.parse(e.response),a=n.data.stats.blockTime,o=n.data.price.usd,r={blockTime:a,price:o};t(r)})["catch"](function(t){e(t)})})}function softFail(t){return new Promise(function(e,n){t.then(e)["catch"](e)})}function makeRequest(t){return new Promise(function(e,n){var a=Date.now(),o=new XMLHttpRequest;o.timeout=t.timeout||3e3,o.open(t.method,t.url),o.onload=function(){if(this.status>=200&&this.status<300){var r={};r.response=o.response,r.elapsed=Date.now()-a,e(r)}else n({status:this.status,statusText:o.statusText,m:"statusNot200",opts:t,elapsed:Date.now()-a})},o.onerror=function(){n({status:this.status,statusText:o.statusText,m:"error",opts:t,elapsed:Date.now()-a})},o.ontimeout=function(){n({status:this.status,statusText:o.statusText,m:"timeout",opts:t,elapsed:Date.now()-a})},t.headers&&Object.keys(t.headers).forEach(function(e){o.setRequestHeader(e,t.headers[e])});var r=t.params;r&&"object"==typeof r&&(r=Object.keys(r).map(function(t){return encodeURIComponent(t)+"="+encodeURIComponent(r[t])}).join("&")),o.send(r)})}function normalize(t,e,n){var a={};a.stats=n;for(var o=0;o<e.length;o++){var r=e[o];if(a.contract=r.contract,r.balance){var i={};i.wei=r.balance.toNumber();var s=1*t.fromWei(i.wei,"ether");i.ether=s;var c=s*n.price;i.dollar=c,a.balance=i}else if(r.remaining||0==r.remaining){var l={};l.blocks=new BigNumber(r.remaining,16).toNumber();var u=l.blocks*n.blockTime;l.totalSeconds=u;var m=Math.floor(u/3600);l.hours=m;var p=Math.floor((u-3600*m)/60);l.minutes=p;var d=Math.floor(u-3600*m-60*p);l.seconds=d,a.remaining=l}else if(r.lastPlayer)a.lastPlayer="0x"+r.lastPlayer.substring(26);else if(r.totalWinners||0==r.totalWinners)a.totalWinners=new BigNumber(r.totalWinners,16).toNumber();else if(r.jackpot||0==r.jackpot){var h={};h.wei=new BigNumber(r.jackpot,16).toNumber();var s=1*t.fromWei(h.wei,"ether");h.ether=s;var c=s*n.price;h.dollar=c,a.jackpot=h}else if(r.price){var f={};f.wei=new BigNumber(r.price,16).toNumber();var s=1*t.fromWei(f.wei,"ether");f.ether=s;var c=s*n.price;f.dollar=c,a.price=f}else if(r.blocks){var g={};g.number=new BigNumber(r.blocks,16).toNumber(),g.duration=g.number*n.blockTime,a.blocks=g}}return a}function padRight(t){return t+pad("",64)}function pad(t,e,n){return n=n||"0",t+="",t.length>=e?t:new Array(e-t.length+1).join(n)+t}function pad(t,e,n){return n=n||"0",t+="",t.length>=e?t:new Array(e-t.length+1).join(n)+t}function askArray(t,e,n,a){console.log(t);var o=CryptoJS.SHA3(e,{outputLength:256}),r=o.toString(CryptoJS.enc.Hex),i=r.substr(0,8);console.log(e+":"+i);for(var s=[],c=n;a>c;c++){var l=c.toString(16),u=i+pad(l,64),m={jsonrpc:"2.0",method:"eth_call",params:[{to:t,data:u},"latest"],id:c};s.push(m)}return s}var LOCAL_PROVIDER="http://localhost:8545",WEB3_PROVIDERS=[LOCAL_PROVIDER,"http://82.85.152.130:8545","http://eth2.augur.net","http://178.62.29.206:8081","http://notworking.it"],DISTANCE_SYNCED=3,ADDRESS="0x884d5B11F7fC9B451f503912d5E5829779335671",CONTRACTS_ABI=[{constant:!0,inputs:[],name:"houseFee",outputs:[{name:"",type:"uint256",value:"10",displayName:""}],type:"function",displayName:"house Fee"},{constant:!0,inputs:[],name:"elapsed",outputs:[{name:"",type:"uint256",value:"1",displayName:""}],type:"function",displayName:"elapsed"},{constant:!1,inputs:[],name:"kill",outputs:[],type:"function",displayName:"kill"},{constant:!0,inputs:[],name:"remaining",outputs:[{name:"",type:"uint256",value:"9",displayName:""}],type:"function",displayName:"remaining"},{constant:!0,inputs:[],name:"lastBlock",outputs:[{name:"",type:"uint256",value:"1214314",displayName:""}],type:"function",displayName:"last Block"},{constant:!0,inputs:[],name:"owner",outputs:[{name:"",type:"address",value:"0x6f4250b4c1db1b611e43cbd9a04c4138c7c0af39",displayName:""}],type:"function",displayName:"owner"},{constant:!0,inputs:[],name:"blocks",outputs:[{name:"",type:"uint256",value:"10",displayName:""}],type:"function",displayName:"blocks"},{constant:!0,inputs:[],name:"price",outputs:[{name:"",type:"uint256",value:"1000000000000000000",displayName:""}],type:"function",displayName:"price"},{constant:!0,inputs:[{name:"",type:"uint256",typeShort:"uint",bits:"256",displayName:"",template:"elements_input_uint"}],name:"winners",outputs:[{name:"winner",type:"address",value:"0x",displayName:"winner"},{name:"pot",type:"uint256",value:"0",displayName:"pot"},{name:"timestamp",type:"uint256",value:"0",displayName:"timestamp"}],type:"function",displayName:"winners"},{constant:!0,inputs:[],name:"totalWinnings",outputs:[{name:"",type:"uint256",value:"0",displayName:""}],type:"function",displayName:"total Winnings"},{constant:!0,inputs:[],name:"lastPlayer",outputs:[{name:"",type:"address",value:"0x6f4250b4c1db1b611e43cbd9a04c4138c7c0af39",displayName:""}],type:"function",displayName:"last Player"},{constant:!0,inputs:[],name:"startedAt",outputs:[{name:"",type:"uint256",value:"0",displayName:""}],type:"function",displayName:"started At"},{inputs:[],type:"constructor"}],printCallback={success:function(t){console.log(1,"success",t)},error:function(t){console.log(2,"error",t)}},statsPromise=getStatsPromise(),initPromise=initProvider(),contractsPromises=getContractsPromises(initPromise),contractsAndStats=Promise.all([statsPromise,contractsPromises]),contractsData={},web3;$(document).ready(function(){initPromise.then(function(t){web3=t.web3;var e=t.lastBlock;$(".identicon").each(function(){var t=$(this),e=t.attr("data-address");if(e){var n=e.toLowerCase();createIdenticon(t,n)}});var n=web3.currentProvider.host;n.indexOf("localhost")>-1?$(".hideiflocal").hide():$(".hideifremote").hide(),$("#blockNumber").html(e),$("#provider").html(n),contractsAndStats.then(function(t){for(var e=t[0],n=t[1],a=0;a<n.length;a++){var o=n[a];o.then(function(t){var n=normalize(web3,t,e);console.log(n);var a=n.contract;contractsData[a]=n;var o=n.balance.dollar,r=n.jackpot.dollar,i=n.balance.ether,s=n.jackpot.ether,c=$("#countdown"+a),l=$("#pcountdown"+a),u=n.remaining,m={hours:u.hours,minutes:u.minutes,seconds:u.seconds};c.countdown(m),l.countdown(m);var p=n.price.dollar.toFixed(2),d=n.price.ether.toFixed(2);$("#price"+a).html(p),$("#pprice"+a).html(p),$("#petherprice"+a).html(d),$("#petherprice2"+a).html(d),$("#petherprice3"+a).html(d);var h=$("#blockstime"+a),f=$("#pblockstime"+a),g=n.blocks.number*n.stats.blockTime,b=Math.floor(g%31536e3%86400/3600);if(b>0)h.html(b+" hour"+(b>1?"s":"")),f.html(b+" hour"+(b>1?"s":""));else{var P=Math.floor(g%31536e3%86400%3600/60);h.html(P+" minute"+(P>1?"s":"")),f.html(P+" minute"+(P>1?"s":""))}$("#pblocks"+a).html(n.blocks.number+" blocks");var v=$("#identicon"+a),w=$("#winner"+a),y=n.remaining.blocks,k=0==new BigNumber(n.lastPlayer,16).toNumber();if(k)v.hide(),w.html("Not started yet"),$("#jackpot"+a).html(o.toFixed(2)),$("#pjackpot"+a).html(o.toFixed(2)),$("#pjackpotether"+a).html(i.toFixed(3));else if(createIdenticon(v,n.lastPlayer),0==y){w.html('wins <span class="icon mif-dollar2 v-align-bottom"></span> <span class="v-align-bottom">'+n.jackpot.dollar.toFixed(2)+"</span>");var N=(o-r).toFixed(2);$("#jackpot"+a).html(N),$("#pjackpot"+a).html(N),$("#pjackpotether"+a).html((i-s).toFixed(3))}else w.html("is the actual winner"),$("#jackpot"+a).html(o.toFixed(2)),$("#pjackpot"+a).html(o.toFixed(2)),$("#pjackpotether"+a).html(i.toFixed(3))})}})})["catch"](function(t){console.log(t)})});